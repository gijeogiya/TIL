# TCP/IP(Transmission Control Protocol/Internet Protocol)
## TCP/IP
- 인터넷 프로토콜 스위트(Internet Protocol Suite)는 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 통신규약(프로토콜)의 모음이다. 인터넷 프로토콜 슈트 중 TCP와 IP가 가장 많이 쓰이기 때문에 TCP/IP 프로토콜 슈트라고도 불린다.
- TCP/IP는 패킷 통신 방식의 인터넷 프로토콜인 IP와 전송 조절 프로토콜인 TCP로 이루어져 있다. IP는 패킷 전달 여부를 보증하지 않고, 패킷을 보낸 순서와 받는 순서가 다를 수 있다. TCP는 IP 위에서 동작하는 프로토콜로, 데이터의 전달을 보증하고 보낸 순서대로 받게 해 준다. HTTP, FTP, SMTP 등 TCP를 기반으로 한 많은 수의 애플리케이션 프로토콜들이 IP 위에서 동작하기 때문에, 묶어서 TCP/IP로 부르기도 한다.
- TCP/IP는 하나의 프로토콜이 아닌 TCP와 IP를 합쳐서 부르는 말이다.
- TCP/IP를 사용하겠다는 것은 IP 주소 체계를 따르고 IP Routing을 이용해 목적지에 도달하며 TCP의 특성을 활요해 송신자와 수신자의 논리적 연결을 생성하고 신뢰서을 유지할 수 있도록 하겠다는 것을 의미한다.
- TCP/IP를 말한다는 것은 송신자가 수신자에게 IP주소를 사용하여 데이터를 전달하고 그 데이터가 제대로 갔는지, 너무 빠르지는 않는지, 제대로 받았다고 연락은 오는지에 대한 이야기를 하는 것이다.

## OSI 7 Layer 에서의 TCP/IP
### Transport Layer(4 Layer)
- 송신자와 수신자의 논리적 연결(Connection)을 담당하는 부분으로 신뢰성 있는 연결을 유지할 수 있도록 도와준다.
- Endpoint(사용자) 간의 연결을 생성하고 데이터를 얼마나 보냈는지 얼마나 받았는지 제대로 받았는지 등을 확인한다.
- TCP(Transmission Control Protocol)와 UDP(User Datagram Protocol)가 대표적
### Network Layer(3 Layer)
- IP(Internet Protocol)가 활용되는 부분으로 한 Endpoint(사용자)가 다른 Endpoint(사용자)로 가고자 할 경우, 경로와 목적지를 찾아준다.
- 이를 Routing이라고 하며 대역이 다른 IP들이 목적지를 향해 제대로 찾아갈 수 있도록 돕는 역할을 한다.
![TCP/IP를 사용하는 Browser와 Server의 통신](https://github.com/user-attachments/assets/d5afaab6-4c3c-47bc-8c69-8209ead26cb9)
- 우리가 인터넷에서 무언가 다운로드할 때 중간에 끊기거나 빠지는 부분 없이 완벽하게 받을 수 있는 이유도 TCP의 이러한 특성, 다시 말해 데이터가 빠지지 않고 제대로 전달되었는지 챙기는 꼼꼼함 덕분이다.
- 그렇기 때문에 HTTP, HTTPS, FTP, SMTP 등과 같이 데이터를 안정적으로 모두 보내는 것이 중요한 프로토콜들이 기반된다.
- TCP를 기반으로 하는 프로토콜들은 차후 언급할 TCP의 '3-way handshake'를 거친 후, 각자 프로토콜(Layer 7)에 기반한 교환 과정을 실시한다는 뜻이다.
![HTTPS의 통신과정](https://github.com/user-attachments/assets/ca4f095a-b77a-40a4-8334-9c9ae7d6ed9a)
- 위 이미지는 TCP 기반의 프로토콜인 HTTPS의 'SSL Handshake'를 도식화한 것이다.
- TCP는 Layer 4이고 HTTPS는 Layer 7이다.
- 파란색 상자는 TCP의 '3-way handshake'이고 노란색 상자는 HTTPS의 'SSL Handshake'이다.
- HTTPS는 TPC 기반의 프로토콜이기 때문에 'SSL Handshake'를 하기에 앞서 '3-way handshake'를 실시한다.
## TCP의 개요
- 전송 제어 프로토콜(Transmission Control Protocol, TCP)은 인터넷 프로토콜 스위트(IP)의 핵심 프로토콜 중 하나로, IP와 함께 TCP/IP라는 명칭으로도 널리 불린다.
- TCP는 근거리 통신망이나 인트라넷, 인터넷에 연결된 컴퓨터에서 실행되는 프로그램 간에 일련의 옥텟을 안정적으로, 순서대로, 에러 없이 교환할 수 있게 한다.
- TCP는 전송 계층에 위치한다. 네트워크의 정보 전달을 통제하는 프로토콜이자 인터넷을 이루는 핵심 프로토콜의 하나이다.
- TCP는 웹 브라우저들이 월드 와이드 웹에서 서버에 연결할 때 사용되며, 이메일 전송이나 파일 전송에도 사용된다.
- TCP는 OSI 7 Layer 중 4계층에 해당한다.
- IP가 패킷들의 관계를 이해하지 못하고 그저 목적지를 제대로 찾아가는 것에 중점을 둔다면 TCP는 통신하고자 하는 양쪽 단말(Endpoint)이 통신할 준비가 되었는지, 데이터가 제대로 전송되었는지, 데이터가 가는 도중 변질되지는 않았는지, 수신자가 얼마나 받았고 빠진 부분은 없는지 등을 점검한다.
- 이런 정보는 TCP Header에 담겨 있으며 SYN, ACK, FIN, RST, Source Port, Destination Port, Sequence Number, Window size, Checksum과 같은 신뢰성 보장과 흐름 제어, 혼잡 제어에 관여할 수 있는 요소들도 포함되어있다.
- IP Header와 TCP Header를 제외한 TCP가 실을 수 있는 데이터 크기를 '세그먼트(Segment)'라고 부른다.
![TCP Header의 구조](https://github.com/user-attachments/assets/d75d24ad-7746-4159-aa42-bdbdc03dc8c8)
- TCP는 IP의 정보 뿐만 아니라 Port를 이용하여 연결한다.
- 한쪽 단말(Endpoint)에 도착한 데이터가 어느 입구(Port)로 들어가야 하는지 알아야 연결을 시도할 수 있기 때문이다.
- 양쪽 단말(Endpoint)이 HTTP로 이루어진 문서를 주고받고자 할 경우 데이터 통신을 하려면 Endpoint의 80 Port로 연결해야 한다.
- 거대한 부산항에 도착했을 때 화무선인 나의 데이터가 상항(화물이 정박하는 항)에 들어가야지 어선항(어선이 정박하는 항)에 들어가면 안되는 것 처럼 말이다.
## TCP의 작동(3-way handshake)
- TCP를 사용하는 송신자와 수신자는 데이터를 전송하기 전 먼저 서로 통신이 가능한 지 의사를 묻고 한 번에 얼마나 받을 수 있는지 등의 정보를 확인한다.
- 이는 신뢰성 있는 통신을 하기 위함이며, 데이터를 안전하고 빠지는 부분 없이 보내기 위함이이다.
- 친구와 통화할 때를 어떻게 하시는지 떠올려보면 좋을 것이다.
```
첫 번째, 전화번호를 누른다. 상대방의 전화기가 꺼져있지 않다면 연결음이 들리면서 연결을 시도한다.
두 번째, 상대방이 전화를 받았고, 상대방은 "여보세요?"라는 말과 함께 자신이 받았음을 알린다. 그리고 목소리가 잘 들린다는 걸 알게 된다.
세 번째, 당신은 "여보세요?" 한 마디와 함께 상대방이 자신의 목소리가 잘 들리는지 확인을 한 후, 대화를 시작한다.
```
- TCP도 이와 동일하다. 다만 TCP는 TCP Header 내의 'SYN', 'SYN/ACK', 'ACK' Flag 를 사용하여 통신을 시도한다.
```
첫 번째, 송신자가 수신자에게 'SYN'을 날려 통신이 가능한지 확인한다. 이때 Port가 열려 있어야 한다.
두 번째, 수신자가 송신자로부터 'SYN'을 받고 'SYN/ACK'을 송신자에게 날려 통신할 준비가 되어있음을 알린다.
세 번째, 송신자가 수신자의 'SYN/ACK'을 받고 'ACK'를 날려 전송을 시작함을 알린다.
```
![3-way hadndshake](https://github.com/user-attachments/assets/d2816c41-af05-4073-b9af-193f28ff01b5)
1. TCP로 이루어지는 모든 통신은 반드시 3-way handshake를 통해 시작한다.
2. 수신자가 받을 생각이 있는지 준비가 되어있는지 송신자가 보낼 준비가 되어 있는지를 미리 확인한 후 통신을 시작하여 데이터를 안전하게 보내는 것이다.
3. 데이터를 받았을 때 잘 받았음을 알리는 'ACK'를 송신자에게 날린다.
4. 송신자는 이 'ACK'를 보고 수신자가 데이터를 잘 받았음을 확인하고 다음 데이터를 전달할 준비를 한다.
5. 이 밖에 주로 사용하는 Flag으로는 RST, FIN, FIN/ACK, PUSH 등이 있다.
## TCP의 특징
![TCP Header](https://github.com/user-attachments/assets/09e754c4-a58b-4d38-9a26-776c01f7cab8)
```
연말이 되면 취약층을 위한 연탄 배송 행사를 많이 하는데, 사람들이 일렬로 줄을 세워 연탄을 하나씩 전달하는 모습을 볼 수 있다. 자세히 보면 연탄을 전달하는 사람은 받는 사람이 얼마나 받을 수 있는지 확인한 후에 전달한다. 확인을 안 하게 되면 연탄을 받는 입장에서 손에 들고 있는 연탄이 있으니 받을 수 없어 앞사람에게서 오는 전달하려는 연탄이 깨지고 말 것이다. TCP도 마찬가지입니다. 
```
### 흐름 제어
- 송신자는 자신이 한 번에 얼마나 보낼 수 있는지, 수신자는 자신이 데이터를 어디까지 받았는지 끊임없이 확인하고 TCP Header 내의 'Window Size'를 사용해 한번에 받고/보낼 수 있는 데이터의 양을 정한다.
- Window는 일정량의 데이터를 말합니다.
- 받는 측의 사정이 더 중요하다 보니 Window Size는 수신자가 정한니다.(3-way handshake 때 정한다.)
- 자신의 상황에 따라 'Window Size'를 조절한다.
- 자신이 지금까지 받은 데이터 양을 확인하여 송신자에게 보내는데 이를 'Acknowledgment Number'라고 한다.
- 만약 수신자가 300번째의 데이터를 받았으면 Acknowledgment Number에 1을 추가하여 301을 보낸다.
- 300번까지 받았으니 301번부터 보내라는 뜻이다.
- 그리고 이 데이터의 순서 번호를 표기한 것이 바로 'Sequence Number'이다.
### 혼잡 제어
- 데이터를 주고받는 양 단말(Endpoint)도 중요하지만 데이터가 지나가는 네트워크망의 혼잡 또한 중요하다.
- 다양한 방법 중에 'Slow Start'에 대해 언급하고자 한다.
- 연결 초기에 송신자와 수신자가 데이터를 넉넉히 주고받을 준비가 되어있더라도 중간 경로인 네트워크가 혼잡하다면? 제대로 보낼 수 없을 것이 자명하다.
- 그리하여 송신자는 연결 초기에 데이터 송출량을 낮게 잡고 보내면서 수신자의 수신을 확인하며 데이터 송출량을 조금씩 늘린다.
- 그리하게 되면 현재 네트워크에서 가장 적합한 데이터 송출량을 확인할 수 있게 된다.
- 이것이 'Slow Start'이다.
