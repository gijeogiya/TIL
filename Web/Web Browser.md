# Web Browser
## 웹페이지를 표시한다는 것: 브라우저는 어떻게 동작하는가
> 사용자는 로드가 빠르고 상호작용이 원활한 컨텐츠로 이루어진 웹 경험을 원한다.      
> 따라서 개발자는 이 두 가지 목표를 달성하기 위해서 부단히 노력해야한다.
     
## 개요
- 빠른 사이트는 더 좋은 사용자 경험을 제공한다.
- 사용자는 로드가 빠르고 상호작용이 원활한 컨텐츠로 이루어진 웹 경험을 원한다.
- 웹 성능에 있어서 두 가지 주요한 문제는 **지연시간**과 브라우저가 대부분 **싱글 쓰레드**로 동작한다는 점이다.
- 빠른 로딩을 하는데 있어서 지연시간은 이겨내야할 중요한 문제이다.
- 빠른 로딩을 위해 신경써야할 것에는 최대한 빠르게 요청하는 것(적어도 체감 상 매우 빠른 수준으로 보내기)도 포함된다.
- 네트워크 지연시간은 네트워크를 통해 컴퓨터로 바이트를 전송하는데 걸리는 시간을 의미한다.
- 웹 최적화는 페이지 로드가 최대한 빠르게 이루어 질 수 있도록 하는 것이다.
- 대부분 브라우저는 싱글 쓰레드이다.
- 원활한 상호작용을 위한 개발자의 목표는 부드러운 스크롤부터 매우 기민하게 반응하는 터치에 이르기까지 성능이 뛰어난 상호 작용을 보장하는 것이다.
- 메인 쓰레드가 요청된 모든 작업을 수행하면서도 유저와의 상호작용에 반응 할 수 있도록 보장하기 위해서는 렌더링 시간이 가장 중요하다.
- 브라우저가 싱글 쓰레드로 동작한다는 점을 이해하고 가능한 메인 쓰레드의 책임을 줄여주는 방식으로 웹 성능 향상을 이룰 수 있다.
- 이렇게 하면 렌더링은 부드럽고 상호작용에 대한 응답은 즉각적일 것이다.
    
## 탐색(Navigation)
- 탐색(Navigation) 은 웹페이지를 로딩하는 첫 단계이다.
- 사용자가 주소창에 URL을 입력하거나, 링크를 클릭하고, 폼(form)을 제출하는 등의 동작을 통해 요청을 보낼 때마다 발생한다.
- 웹 최적화의 목표 중 하나는 탐색이 완료될 때까지의 시간을 최소화 하는 것이다.
- 이상적인 조건에서 그다지 오래 걸리는 작업이 아니지만 지연시간과 대역폭은 지연을 일으키는 적이다.
     
### DNS 조회(DNS Lookup)
- 웹 페이지를 탐색하는 첫 단계는 해당 페이지의 자원이 어디에 위치하는지 찾는 것이다.
- 만약 https://example.com를 탐색한다면 HTML 페이지는 IP 주소가 93.184.216.34인 서버에 위치하고 있다.
- 만약 이 사이트를 한 번도 방문한 적이 없다면 DNS 조회가 필요하다.
- 브라우저는 DNS 조회를 요청한다. 이는 최종적으로 이름 서버에 의해서 처리되고, IP 주소로 응답한다.
- 최초의 요청 이후에, IP는 일정 기간 동안 캐시된다. 이름 서버에 다시 연락하는 대신 캐시에서 IP 주소를 검색하여 후속 요청 속도를 높인다.
- DNS 조회는 보통 호스트 이름 하나당 한 번만 수행된다.
- 하지만 DNS 조회는 요청된 페이지에서 참조하는 다른 호스트 이름에 대해서는 각각 수행해야한다.
- 만약 글꼴, 이미지, 스크립트, 광고 그리고 다른 자원들이 서로 다른 호스트 이름을 가지고 있다면, DNS 조회는 각각에 대해서 모두 수행되어야 한다.     
![image](https://github.com/user-attachments/assets/120ce705-19cc-4019-b673-c676efa17168)
- 이는 특히 모바일 네트워크 환경에서 성능에 문제가 될 수 있다.
- 사용자가 모바일 환경에 있을 때, 각각의 DNS 조회는 휴대폰에서 셀 타워에 가야하고, 셀 타워에서 권위 있는 DNS 서버에 도달해야한다.
- 휴대폰과 셀 타워, 그리고 이름 서버의 거리에 따라서 상당한 지연시간이 생길 수도 있다.
### TCP 핸드셰이크(TCP Handshake)
- IP 주소를 알고난 후에는, 브라우저는 서버와 TCP 3방향 핸드셰이크를 통해 연결을 설정한다.
- 이 방식은 데이터를 전송하기 전에 (주로 HTTPS를 통해서) 통신하려는 두 주체(이 경우에는 브라우저와 웹 서버)가 TCP 소켓 연결을 위한 매개변수를 주고 받을 수 있도록 만들어졌다.
- TCP의 3방향 핸드셰이크 기술은 "SYN-SYN-ACK" (더 정확히는 SYN, SYN-ACK, ACK)로 불리기도 한다.
- 두 컴퓨터 간 TCP 세션을 협상하고 시작하기 위해서 TCP가 3개의 메세지를 전달하기 때문이다.
- 이는 요청이 보내지기 전에 3개의 추가적인 메세지가 컴퓨터 사이에 주고받아진다는 의미이다.
### TLS 협상(TLS Negotiation)
- HTTPS를 이용한 보안성있는 연결을 위해서는 또 다른 "핸드셰이크"가 필요하다.
- (TLS 협상이라고 할 수 있는) 이 핸드셰이크는 통신 암호화에 쓰일 암호를 결정하고, 서버를 확인하고, 실제 데이터 전송 전에 안전한 연결이 이루어지도록 한다.
- 이를 위해서 자원에 대한 실제 요청 전에 클라이언트에서 서버로 3번 더 왕복해야한다.      
![image](https://github.com/user-attachments/assets/c7f1c644-53bf-4879-a0f0-7af9482f6079)     
- 연결에 보안성을 더하는 것은 페이지 로딩을 더디게 한다.
- 하지만 보안성있는 연결은 지연시간이라는 비용을 낼만큼 충분히 가치가 있다.
- 브라우저와 웹서버 사이에 전송되는 데이터가 제 3자에 의해서 해독될 수 없게 되기 때문이다.
- 8번의 왕복이 있은 후에, 브라우저는 마침내 요청을 할 수 있다.
