# 점진적 새로고침(Incremental Refresh)
## 점진적 새로고침이란?
매일 쌓이는 수천 개의 쇼핑몰 주문 데이터를 관리한다고 가정하고. 매번 전체 데이터를 처음부터 다시 불러온다면 시간도 오래 걸리고 컴퓨터 자원도 많이 소모됩니다. **점진적 새로고침(Incremental Refresh)**은 이런 문제를 해결하는 똑똑한 방법입니다.

쉽게 말해, **"이미 가져온 건 그대로 두고, 새로 생기거나 바뀐 것만 가져오자"**는 개념입니다. 마치 뉴스 앱에서 '새 글만 보기' 기능을 사용하는 것과 비슷하죠. 매번 전체 기사를 다시 읽는 대신, 마지막으로 확인한 이후의 새 기사만 보는 것처럼 말입니다.

### 전체 새로고침 방식:
- 도서관의 모든 책(100만 권)을 매일 아침마다 전부 꺼내서 다시 정리
- 시간도 오래 걸리고, 사람도 많이 필요함
### 점진적 새로고침 방식:
- 어제 이후 새로 들어온 책(100권)과 수정된 책(50권)만 처리
- 훨씬 빠르고 효율적

## 작동 방법
점진적 새로고침이 작동하려면 "어떤 게 새로운 데이터인지" 구분할 수 있는 기준이 필요합니다. 많이 사용하는 방법은 아래와 같습니다.

1. 날짜/시간 기준 방식
데이터마다 "마지막 수정 시간" 정보를 기록해두고, 이를 기준으로 새로운 데이터를 찾습니다.

``` sql
-- 예시: 2024년 1월 1일 이후 변경된 주문 데이터만 가져오기
SELECT 주문번호, 고객명, 주문금액, 수정일시
FROM 주문테이블
WHERE 수정일시 > '2024-01-01 00:00:00'
```

이 방식은 매우 직관적이고 구현하기 쉬워서 가장 많이 사용됩니다. 예를 들어, 매일 밤 자정에 데이터를 업데이트한다면 "오늘 하루 동안 생성되거나 수정된 데이터"만 가져오면 됩니다.

2. 변경 추적 방식 (CDC - Change Data Capture)
데이터베이스에서 일어나는 모든 변경사항을 실시간으로 기록하는 방법입니다. 마치 CCTV처럼 데이터의 변경 내역을 추적합니다.

```python
# 간단한 예시 코드
# 마지막 업데이트 시점 확인
last_update = "2024-01-15 10:00:00"

# 그 이후 변경된 데이터만 가져오기
new_data = database.get_changes_since(last_update)

# 기존 데이터에 추가
warehouse.append(new_data)

# 현재 시간을 새로운 업데이트 시점으로 저장
save_last_update_time("2024-01-15 11:00:00")
```
이 방식은 데이터의 추가(INSERT), 수정(UPDATE), 삭제(DELETE)까지 모두 정확하게 추적할 수 있어서 더욱 정밀합니다.

3. 파티션 기반 방식
데이터를 날짜별, 월별 등으로 나누어 저장하고, 최근 파티션만 새로 고치는 방법입니다.
```
📁 데이터 저장 구조
├─ 2024년 1월 데이터 ✅ (확정, 변경 없음)
├─ 2024년 2월 데이터 ✅ (확정, 변경 없음)
└─ 2024년 3월 데이터 🔄 (이번 달, 계속 업데이트)
```
3월이 끝나지 않았다면 3월 파티션만 계속 업데이트하고, 1~2월 데이터는 그대로 둡니다.

## 점진적 새로고침을 사용하는 이유
1. 시간 절약
1억 개의 고객 데이터가 있는데, 하루에 1만 개만 변경된다고 가정해봅시다.

- 전체 새로고침: 1억 개 전부 처리 → 10시간 소요
- 점진적 새로고침: 1만 개만 처리 → 6분 소요
무려 100배 빠른 처리가 가능합니다.

2. 비용 절감
클라우드 환경에서는 데이터 전송량과 처리 시간에 따라 비용이 청구됩니다. 전체 데이터를 매번 전송하면 비용이 크게 증가하지만, 변경된 데이터만 전송하면 네트워크 비용과 컴퓨팅 비용을 획기적으로 줄일 수 있습니다.

3. 더 자주 업데이트 가능
전체 새로고침에 10시간이 걸린다면 하루에 한 번밖에 업데이트할 수 없습니다. 하지만 점진적 새로고침으로 6분이면 끝난다면, 1시간마다, 심지어 10분마다도 업데이트할 수 있어 항상 최신 데이터를 유지할 수 있습니다.

4. 시스템 부하 감소
대용량 데이터를 한꺼번에 처리하면 서버에 부담이 크지만, 소량의 데이터를 처리하면 다른 작업에 영향을 주지 않고 안정적으로 운영할 수 있습니다.

## 주의할 점
점진적 새로고침은 매우 유용하지만, 몇 가지 주의해야 할 사항이 있습니다.

1. 삭제된 데이터 처리
새로 추가되거나 수정된 데이터는 쉽게 찾을 수 있지만, 삭제된 데이터는 어떻게 알 수 있을까요?

해결 방법:
- "실제로 삭제하지 않고" 삭제 표시만 함 (Soft Delete)
- 삭제 시간을 기록하는 컬럼 추가
```sql
-- 삭제 표시 방법
UPDATE 주문테이블 
SET 삭제여부 = 'Y', 삭제일시 = NOW()
WHERE 주문번호 = '12345'
```

2. 초기 설정
점진적 새로고침을 시작하려면 처음 한 번은 전체 데이터를 로드해야 합니다. 이를 "초기 로드(Initial Load)" 또는 "풀 로드(Full Load)"라고 합니다. 이후부터 점진적으로 업데이트하면 됩니다.

3. 데이터 일관성
여러 테이블이 연결되어 있을 때는 모든 관련 테이블을 함께 업데이트해야 데이터 불일치가 발생하지 않습니다.

예시:
- 주문 테이블 업데이트 → 연관된 고객 정보도 함께 업데이트
- 제품 재고 업데이트 → 연관된 주문 정보도 확인

4. 오류 발생 시 복구
업데이트 중간에 오류가 발생하면 어떻게 할까요?

대응 방법:
- 트랜잭션 기능 사용 (성공하면 전체 적용, 실패하면 전체 취소)
- 백업 시점 정보 저장
- 재시도 로직 구현

## 마무리
점진적 새로고침은 현대 데이터 처리에서 거의 필수적인 기법입니다. 이미 사용하고 계시기 때문에 너무나도 익숙해서 오히려 낯선 개념일 수도 있을 것 같습니다.      
마치 매번 방 전체를 청소하는 대신, 더러워진 부분만 깨끗이 하는 것이 효율적인 것 처럼 효율적으로 데이터를 처리하기 위한 점진적 새로고침에 대해 알아봤습니다. 감사합니다!
