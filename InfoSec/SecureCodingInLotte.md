# 시큐어 코딩(Secure Coding)
2024.06.27
## 1. 정보보안의 이해
### 네트워크
- 네트워크
- 병렬 처리가 가능해지고 성능의 햐상
- 네트워크(특히 인터넷) 상에 다양한 서비스 가능
### 네트워크의 역사
- 1960년대 말 미국방성에서 여러 고성능 컴퓨터를 네트워크로 묶는 작업을 시작
- 1980년대 초 TCP/IP 프로토콜 개발
- 유선 --> 무선 --> 모바일 인터넷의 발달
- 20여년 동안 네트워크는 비약적으로 발전하여 현대 생활의 일부가 되었음
### 네트워크의 개요와 시작
- 네트워크
- 모뎀의 개발과 네트워크의 시작
### 장거리 컴퓨터 통신과 인터넷
- 장거리 컴퓨터 통신과 인터넷의 시작
- 버너스-리의 웹 개념: 서로 다른 컴퓨터끼리 정보를 공유하고 서로 링크하여 찾기 쉬운 **하이퍼텍스트** 형태의 서비스를 도입하자는 것
### 보안의 3대 요소
- 보안은 기밀성, 무결성, 가용성이라는 세 가지 속성으로 집약
### 기밀성
- 보안에서 기밀성
  - 인가된 사용자만 정보 자산에 접근할 수 있다는 것
  - 기밀성 예는 보안 관련 시스템과 소프트웨어, 방화벽, 암호, 패스워드
- 네트워크 보안에서 기밀성
  - 서버와 클라이언트 간, 서버와 서버 간, 클라이언트와 클라이언트 간의 통신에서 허락되지 않은 사용자 또는 객체가 정보의 내용을 알 수 없도록 하는 것
  - 기밀성을 해치는 공격은 스니핑
### 무결성
- 보안에서 무결성
  - 권한을 가진 사용자가 인가한 방법으로만 정보를 변경할 수 있도록 하는 것
  - 무결성 해치는 예는 위조 지폐
- 네트워크 보안에서 무결성
  - 클라이언트와 서버 가느이 데이터가 변조되지 않고 전송되는가
  - 무결성을 해치는 공격은 세션 하이재킹
### 가용성
- 보안에서 가용성
  - 필요한 시점에서 정보 자산에 대한 접근이 가능하도록 하는 것
  - 가용성을 상품화한 예는 24시간 편의점
- 네트워크 보안에서 가용성
  - 허락된 사용자 또는 객체가 네트워크를 통해 정보에 접근하려고 할 때 방해 받지 않도록 하는 것
  - 가용성을 해치치는 공격은 서비스 거부 공격(DoS)
### 네트워크 보안의 5대 요소
- 정보 보안의 3대 요소
  - 기밀성
  - 무결성
  - 가용성
- 추가 요소
  - 서버 인증
  - 클라이언트 인증
### 네트워크 보안에서 서버 인증
- 클라이언트가 올바른 서버로 접속하는가
- 올바른 클라이언트가 접속을 시도하는가
### 보안 전문가의 자격 요건
- 사이버 범죄의 유형
  - 사이버 테러형 범죄
  - 일반 사이버 범죄
- 윤리 강령
- 윤리 의식
  - 정보통신망 이용촉진 및 정보보호 등에 관한 법률
  - 정보통신기반 보호법
  - 클라우드 컴퓨팅법
  - 전자정부법
- 다양한 분야의 지식
  - 운영체제
  - 네트워크
  - 프로그래밍
  - 서버
  - 보안 솔루션
  - 모니터링 시스템
  - 정책과 절차
## 2. 시스템 보안
### 시스템
- 시스템은 하드웨어뿐만 아니라 소프트웨어까지 매우 많은 것을 포괄
- 계정 관리
- 세션 관리
- 접근 관리
- 권한 관리
- 로그 관리
- 취약점 관리
### 계정 관리
- 식별과 인증
  - 식별: 어떤 시스템에 로그인하려면 먼저 자신이 누군지를 알림
  - 인증: 로그인을 허용하기 위한 확인
- 보안의 네 가지 인증 방법
  - 알고 있는 것: 머릿속에 기억하고 있는 정보를 이용하여 인증 수행
  - 가지고 있는 것: 신분증이나 OTP 장치 등으로 인증 수행
  - 자신의 모습: 홍채와 같은 생체 정보로 인증 수행
  - 위치하는 곳: 현재 접속을 시도하는 위치의 적절성을 확인하거나 콜백을 사용해 인증 수행(휴대폰 인증번호 등)
### 운영체제의 계정 관리
- 운영체제: 시스템을 구성하고 운영하기 위한 가장 기본적인 소프트웨어
- 윈도우의 계정 관리
  - 관리자 계정: administrator / 시스템에 가장 기본으로 설치되는 계정
- 윈도우의 계정 관리
- 유닉스의 계정 관리
  - 기본 관리자 계정으로 root가 존재
- 데이터베이스의 계정 관리
- 응용 프로그램의 계정 관리
- 네트워크 장비의 계정 관리
### 세션
- 세션의 개요
  - '사용자와 시스템 사이 또는 두 시스템 사이의 활성화된 접속'을 의미
  - 동화 <해님 달님>의 이야기
- 지속적인 인증
  - 세션을 유지하기 위한 보안 사항 중 하나
  - 인증에 성공한 후 인증된 사용자가 처음의 사용자인지 지속적으로 재인증 작업을 거치는 작업
  - 매번 패스워드를 입력 할 수 없으므로 시스템은 이를 세션에 대한 타임아웃 설정으로 보완
  - 반면 유닉스는 원격에서 접속한 경우 패스워드를 다시 묻지 않고 세션을 종료한 후 재접속할 것을 요구
### 접근 제어
- 접근 제어: 적절한 권한을 가진 인가자만 특정 시스템이나 정보에 접근하도록 통제하는 것
### 운영체제의 접근 제어
- 불필요한 인터페이스 제거
- inetd 데몬: 데몬과 클라이언트의 요청을 연결
- tcpd 데몬은 접속을 요구한 클라이언트에 적절한 접근 권한이 있는지 확인한 후 해당 데몬에 연결을 넘겨줌
### 데이터베이스의 접근 제어
- 데이터베이스
  - 오라클: $ORACLE_HOME/network/admin/sqlnet.ora
### 응용 프로그램의 접근 제어
- NGINX
- 네트워크 장비
### 운영체제의 권한 관리
- 원도우
- 유닉스
### 데이터베이스의 권한 관리
- 질의문에 대한 권한 관리
- DDL과 DML은 DCL에 의해 허용 또는 거부
- 뷰에 대한 권한 관리
  - 뷰: 참조 테이블의 각 열에 대해 사용자의 권한을 설정하는 것이 불편해서 만든 가상 테이블
  - 생성된 뷰에 대한 권한 설정은 테이블에 대한 권한 설정과 같음
### 취양점 관리
- 패치 관리
  - 응용 프로그램을 만든 제작사가 배포하는 패치 또는 서비스 팩을 적용
- 응용프로그램별 고유 위험 관리
  - 응용 프로그램을 통해 운영체제의 파일이나 명령을 실행시킬 수 있는 것이 있음
- 응용 프로그램의 정보 수집 제한
## 4. 로그 관리
### 로그 관리의 개요
- AAA 요소
  - 시스템 사용자가 로그인한 후 명령을 내리는 과정에 대한 시스템의 동작
  - 로그를 남기는 모든 시스템에 존재
  - AAA에 대한 로그 정보는 해커나 시스템에 접근한 악의적인 사용자를 추적하는데 많은 도움이 됨
  - 책임 추적성: 추적에 대한 기록의 충실도
  - 감사 추적: 보안과 관련하여 시간대별 이벤트를 기록한 로그
- Authentication (인증)
  - 자신의 신원을 시스템에 증명하는 것
- Accounting
  - 로그인했을 때 시스템이 이에 대한 기록을 남기는 활동
  - 객체나 파일에 접근한 기록
### 운영체제의 로그 관리
- 윈도우의 로그
  - 윈도우 서버 2012의 경우 로깅 항목과 설정 사항은 [로컬 보안 정책] 대화상ㅇ자의 [감사 정책] 메뉴에서 확인
  - 로깅 정책
  - 개별 로그
  - 윈도우의 감사 정책
- 유닉스의 로그
  - 유닉스 시스템의 로그 저장 위치
    - 일반적으로 리눅스에서는 /var/log 디렉터리에 로그가 존재
  - 유닉스 로그의 종류
    - sudo: 가장 중요
    - utmp: 가장 기본적인 로그, 로그인 계정의 형식, 로그오프 여부, 시간에 대한 저장 구조 확인
    - wtmp: utmp 데목과 비슷하게 사용자 로그인과 로그아웃, 시스템 재부팅에 대한 정보 확인 가능
    - secure(sulog)
    - history
    - syslog: 시스템 운영과 관련한 전반적인 로그
### 데이터베이스의 로그 관리
- MS-SQL의 로그
- MySQL의 로그
  - Error, General, Slow Query, Birnary, Relay
  - General 로그의 경우, 현재 설정을 확인
  - General 로그는 설정 해제 가능
- Oracle의 로그
  - AUDIT_TRAIL 설정
    - OS단이나 DB단에 남길 지 설정 가능
  - 각각의 감사는 감사 뷰를 통해 확인
 - 데이터베이스 모니터링
   - 네트워크 트래픽을 모니터링할 수 있는 태핑 장비를 네트워크에 설치
   - 네트워크 패킷 중에서 데이터베이스 질의문을 확인하여 이를 로그로 남김
### 응용 프로그램의 로그 관리
- IIS 웹 서버의 로그
  - 제어판의 로깅 항목에서 확인
  - 실제 로그는 디렉터리에 남음
- 아파치 웹 서버의 로그
  - 403 Error는 권한이 없음을 의미
### 네트워크 장비의 로그 관리
- 로그 서버: 로그 서버를 별도로 운영하면 네트워크 장비에 침투하더라도 흔적을 지우기 쉽지 않음
## 5. 네트워크 패킷 분석
### WireShark
- 패킷을 스니핑하는데 필요한 USBPcap 함께 설치
- 페킷 스니핑 실행하기
- 패킷 스니핑 중지
- 특정 프로토콜만 스니핑하기
- 서버(리눅스)와 클라이언트(윈도우)
- 2계층에서 OSI계층의 패킷 흐름 이해하기
### 페킷 트레이서
- 시스커(CISCO)에서 개발한 네트워크 시뮬레이션 툴
- 방화벽, VPN, 서버, 네트워크 장비, 종류별 케이블 연결, 접근 제어, 무선 네트워크 등을 설정할 수 있어 각 하드웨어 장비에 대해 쉽게 이해 할 수 있고 가상 환경에서 시뮬레이션을 통해 네트워킹이 어떻게 동작하는지 분석 가능
## 2. 소프트웨어 보안과 시큐어 코딩
## 1. 모리스 웜과 CERT-C
### 모리스 웜(Morris Worm)
- 버퍼 오버플로우 공격 유행
- 전통적인 보안 취약점
  - 문제있는 표준 라이브러리 함수 사용 자제(atoi(), strcpy(), strcat(), gets(), sprintf() 등)
### CERT C 보안 코딩
- CERT(Computer Emergency Response Team)
- 안전성, 신뢰성 및 보안을 보장
### MISRA-C
- 자동차와 항공과 같은 장비들의 신뢰성 확보
  - MISRA(Motor Industry Software Reliablity Association)에서 개발된 C 프로그래밍에 대한 개발 표준
  - ISO C언어로 작성된 임베디드 시스템의 코드 안전성, 호환성, 신뢰성
  - 자동차 산업 이외의 산업에 다양하게 사용: 항공, 의료장비, 국방 철도 등
- 3단계
  - 필수: 위반이 허용되지 않는 지침
  - 요구: 경우에 따라 위반할 수 있는 가이드 라인
  - 자문: 합리적으로 한도 내에서 권고 사항을 준수
### DAPA SCR-R
- 방위력 개선사업으로 개발되는 소프트웨어의 품질 및 신뢰성 향상을 위해 코딩 시 준수해야할 규칙: 적용 규칙(66개)
### 코딩 규칙(Coding Rule) 비교 차트
- 각 코딩 규칙별로 지원하는 범위가 다르다
  - 안전(Safety) vs 보안(Security)
- 보안 시스템
- 안전 크리티컬(중요) 시스템
### 클린코드
- 코딩 스타일가이드를 준수하고 있는가?
- 코드는 잘 구조화되어 있는가?(가독성과 기능적 측면)
- 데이터에 맞게 타이빙 구체적으로 선언되었는가?
- 변수의 범위는 적절하게 선언되었는가?
- 전역변수를 최소화했는가?
- 숫자를 직접 서술하지 않고 상수를 사용하고 있는가?
- 주석을 적절하게 기술돼 있는가?
- 주석처리된 코드는 삭제되었는가?
- 각 함수의 정보는 코드를 설명하기에 충분한가?
- 설명을 보거나 작성자에게 물어봐야만 이해할 수 있는 코드가 존재하는가?
- 헤더, 함수 정보를 도구로 추출해서 자동으로 문서화할 수 있는 구조인가?
- if ~ else 구문에서 2단계 이상 중첩이 있는가? 중첩되었다면 함수로 더 구분했는가? ...
## 시큐어 코딩의 개요
### 시큐어 코딩
- 소프트웨어 개발
  - 요구사항 도출 - 설계 - 구현(개발) - 테스트 - 릴리즈
- 시큐어 코딩
  - 구현(개발) 단계에서 해킹 등의 공격을 유발할 가능성이 있는 잠재적인 보안 취약점을 사전에 제거하여, 외부 공격으로부터 안전한 소프트웨어를 개발하는 기법을 의미
  - 릴리즈 이전에 소프트웨어 취약점을 50% 줄이면, 침해사고 대응 비용이 75% 감소
  - 92%의 보안 취약점이 어플리케이션에서 발견
  - IBM: 설계 단계에서 적용하는 것이 100배 효율적
### S/W 안정성
- 정상적인 작동을 하지 못하게 하는 모든 것으로부터의 보호
  - 고의적인 에러 발생이나 오류값에 의한 이상작동, 외부공격에 대한 취약성, 내부/개인정보의 유출, 정상적인 기능의 오용, 성능저하 등
  - 꼼꼼하고 단단한 코딩을 하자
- 시큐어 코딩
  - 소프트웨어의 안정성을 코딩 단계부터 확보
  - 대한민국 행안부 가이드
    - Java, AOS, C언어 등에 대한 지침 마련
    - 시큐어코딩 점검툴
- 보안/취약점 없는 강건한 프로그램을 작성하는 것
  - S/W 개발 과정에서 개발자 실수, 논리적 오류 등으로 S/W에 내재될 수 있는 보안 취약점의 원인, 즉 보안 약점을 최소화하는 과정
### 시큐어 코딩과 침입
- 2차 소프트웨어 위기: Trustworthiness
- 침입 양상의 변화
- 미국: 2011년 11월 "안전한 사이버 미래를 위한 청사진"
- 보안 침해의 75% 이상이 응용 소프트웨어와 관련
- 운영단계에서 적용하는 것 보다 설계단계에서 적용하는 것이 훨씬 경제적
### 웹서비스 침해사고 발생빈도
- Application 단계에서 발생하는 비율이 75%
### S/W 개발보안 개념
- 안전한 SW 개발을 위해 소스코드 등에 존재할 수 있는 잠재적인 보안취약점을 제거하고, 정보보호를 고려하여 SW를 설계/구현하는 등의 SW개발과정에서의 일련의 보안활동
### 보안 약점과 취약점
- 보안 약점(Weakness)
  - 보안 취약점이 될 수 있는 소프트웨어의 겸함, 실수, 버그 등
  - 보안 취약점은 SW보안 약점에 포함되며, 모든 보안 약점이 보안 취약점은 아니다.
  - 시큐어 코딩은 보안 약점이 없도록 개발하는 기법
  - CWE(Common Weakness Enumeration)
  - 일반적인 형태/근원적
- 보안 취약점(Vulnerability)
  - 해킹 등 실제 침해사고에 이용되는 보안 취약점
  - 공격자가 이용할 경우에 시스템의 보안 정책을 침해하게 되는 시스템 허점
  - SW 보안 약점 중 해킹을 유발하는 실제 인스턴스를 의미
  - 개발단계에서 원인을 제거하거나, 구현 후 해커보다 먼저 찾아서 제거해야 함
  - CVE(Common Vulnerablity Exposure)
  - 개별적/상황 의존적
## 3. S/W 보안 약점
### S/W 보안약점의 주요 유형
- 입력 데이터 검증 및 표현
  - 적절한 검증없이 사용된 외부입력으로 인한 소프트웨어의 취약점
  - 문자열 삽입
    - SQL Injection
    - XSS
    - OS 명령어 삽입
  - 버퍼 넘침
  - 자원 삽입
  - 숫자값 오류
- API 오용
  - 적합하지 않은 인자를 사용한 API의 사용이나 API결과에 대한 적절하지 않은 가정에 의한 약점
  - DNS lookup에 의존한 보안 결정
  - 결과값 검사 누락
  - 안전하지 않은 함수 사용
  - 지워지지 않은 힙메모리에 남아있는 데이터
- 보안 기능
  - 인증, 접근제어, 암호화, 권한 관리 등과 관련된 소프트웨어 약점
  - 취약한 알고리즘 사용
  - 솔트없이 단방향 해쉬 함수 사용
  - 무결성 검사 없는 코드 다운로드
  - 사용자 중요 정보 평문 저장
- 시간 및 상태
  - 복수의 쓰레드나 프로세스들의 병행 수행과 관련하여 시점과 상태를 적절히 처리하지 못하여 발생하는 약점
    - 경쟁조건: 검사시점과 가용시점
    - 제대로 제어되지 않은 재귀
- 에러 처리
  - 에러를 처리하지 않거나, 불충분하게 처리하여 발생하는 시스템의 불안정이나 정보 누출과 관련한 약점
- 코드 오류
  - 소프트웨어의 질관리가 부실함을 보여주는 약점들로 일반적으로 취약점으로 직접 연관되지는 않는다
- 캡슐화
  - 중요한 데이터나 함수에 대한 불완전한 캡슐화
## 4. S/W 개발 보안 제도
### 제도 개요: 대상 및 범위
- 정보시스템 개발단계에서 SW(소스코드) 보안약점 제거 의무화
  - 근거: 정보시스템 구축/운영 지침(행정안전부고시 제2012.25호)
### 제도 개요: 주체별 역할
- 안행부, 행정기관, 개발업체, 감리법인
### S/W 개발보안 체계
- 국가정보원: 개발보안가이드 협의, 진단도구 CC 인증('14.1월부터 인증된 도구사용 의무화)
## 5. S/W 보안 약점 진단
### SW 보안성 분석: 개요
- 보안기능 분석, 보안 메커니즘 분석, 취약점 분석, 침투 시험
### SW 보안성 분석: 테스트 유형
- 화이트박스 테스트, 블랙박스 테스트, 정적 분석, 동적 분석, 자동 분석, 수동 분석
### 진단도구 기반 소스코드 분석
- 진단도구 기반 자동화된 코드리뷰 지원
- 매뉴얼 코드리뷰의 단점을 보완: 수백가지 보안문제를 짧은 시간에 검토
  - 많은 시간이 필요
  - 진단자의 실력에 의존
- 샘플링 테스트 기반의 동적 분석(모의해킹 등)에 비해 소스코드 전체를 진단
- 정/오탐 문제 발생 및 전문가 검토 필수, 진단도구 실뢰성 중요
### 사업단계별 개발보안 진단활동
- 기획/검토
- 계획 수립
- 사업자 선정/계약 --- 개발보안 진단계획 수립 및 협의
- 개발/구축 --- SW개발보안 준수여부 중간 점검(1차)
- 감리 --- SW개발보안 준수여부 중간 점검(2차)
- 검사/종료
### 개발보안 진단시 고려사항
- 소스코드 확인
- 진단규칙 확인(튜님) - 진단도구 기반 보안약점 진단
- 정/오탐 판정 등 진단결과 분석
- 진단보고서 작성 및 조치방안 컨설팅 - 보완조치 이행점검 실시
